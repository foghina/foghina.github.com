
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Git: Moving History - Code Ramblings</title>
  <meta name="author" content="Felix Oghină">

  
  <meta name="description" content="The title of this post may make it sound like it&rsquo;s going to be about how git changed the face of software development and entered us into a
new &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://felix.oghina.com/2014/07/23/git-moving-history">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Code Ramblings" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,300,400' rel='stylesheet' type='text/css'>

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-8187528-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Code Ramblings</a></h1>
  
    <h2>Code. Rant. Repeat.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:felix.oghina.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Git: Moving History</h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-07-23T20:37:24+03:00" pubdate data-updated="true">Jul 23<sup>rd</sup>, 2014</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>The title of this post may make it sound like it&rsquo;s going to be about how git changed the face of software development and entered us into a
new era of coding collaboration. No. This post is about how to copy a subtree from one git repository to another, while keeping its history.</p>

<p>Let&rsquo;s say you&rsquo;ve been working on a component in an incubator-style repository, and it&rsquo;s time to move it to the main project&rsquo;s repository.
Simply copying the code would destroy the valuable history in the target repo, so that should be avoided. There are also lots of other
components in the incubator repo that you don&rsquo;t want to move.</p>

<h2>Step 1: Export your component to a temporary repository</h2>

<p>You can do this using <code>git filer-branch</code>. <em>Warning:</em> this will reduce your local copy of the incubator repository to <em>just</em> your component.
Either clone it locally to a different path or be prepared to clone it again from the remote.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='console'><span class='line'><span class="go">incubator$ git filter-branch --subdirectory-filter components/my-component -- --all</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now your repository has been reduced to just the contents <strong>and history</strong> of <code>components/my-component</code>.</p>

<h2>Step 2: Create a patch for the entire history of your component</h2>

<p>Use <code>git format-patch</code> to export all of your commits to a patch file. Props to <a href="https://twitter.com/rombert">@rombert</a> for this idea.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='console'><span class='line'><span class="go">incubator$ git format-patch --stdout --root $(git rev-list HEAD | tail -n 1) HEAD &gt; my-component.patch</span>
</span></code></pre></td></tr></table></div></figure>


<p>I feel like this command could use some explaining. First off, we&rsquo;re telling <code>format-patch</code> to output everything to <code>--stdout</code>. Otherwise,
it would create one patch file per commit, which can get pretty clumsy if there are lots of them. Second, we&rsquo;re passing the output of
<code>git rev-list HEAD | tail -n 1</code> for the <code>--root</code> parameter. The enclosed command will find find the <code>sha1</code> of the very first commit, while
the <code>--root</code> parameter will tell <code>format-patch</code> to include that commit, not start from it. Lastly, <code>HEAD</code> is the target ref, which is
basically the most recent commit.</p>

<h2>Step 3: Apply the patch</h2>

<p>Now it&rsquo;s time to add your component to the main project. Of course, you don&rsquo;t want to add your component to the root of the repository
(which is what all the paths in the patch are relative to). Thankfully, git supports prepending a path to all filenames in a patch.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='console'><span class='line'><span class="go">main-project$ git am --directory components/my-component my-component.patch</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now your main project contains your component and all of its history. Some notes:</p>

<ol>
<li>Only one branch will be copied. If your component development happened on multiple branches, that will be lost.</li>
<li>No tags will be copied to the main repository, you will need to tag your commits manually.</li>
<li>Commit IDs will change, so you will not be able to <a href="https://github.com/foghina/git-copy-tags">copy your tags automatically</a>.</li>
</ol>


<p>Pretty neat.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Felix Oghină</span></span>

      








  


<time datetime="2014-07-23T20:37:24+03:00" pubdate data-updated="true">Jul 23<sup>rd</sup>, 2014</time>
      

<span class="categories">
  
    <a class='category' href='/categories/coding/'>coding</a>, <a class='category' href='/categories/shell/'>shell</a>
  
</span>


    </p>
    
      <div class="sharing">
  <script type="text/javascript" src="http://www.reddit.com/static/button/button3.js"></script>
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://felix.oghina.com/2014/07/23/git-moving-history/" data-via="foghina" data-counturl="http://felix.oghina.com/2014/07/23/git-moving-history/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/2012/11/18/video-surveillance-in-bash/" title="Previous Post: Video Surveillance... in Bash">&laquo; Video Surveillance... in Bash</a>
      
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2014/07/23/git-moving-history/">Git: Moving History</a>
      </li>
    
      <li class="post">
        <a href="/2012/11/18/video-surveillance-in-bash/">Video Surveillance... in Bash</a>
      </li>
    
      <li class="post">
        <a href="/2012/10/04/how-to-fuck-up-with-find/">How to fuck up with find</a>
      </li>
    
      <li class="post">
        <a href="/2012/04/22/beware-of-the-javascript-reference/">Beware of the JavaScript reference!</a>
      </li>
    
      <li class="post">
        <a href="/2012/04/17/rails-setup-with-rvm-on-ubuntu/">Rails setup with RVM on Ubuntu</a>
      </li>
    
  </ul>
</section>



<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/+FelixOghină?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



<section class="stackoverflow">
  <a href="http://stackoverflow.com/users/180784/felix">
    <img src="http://stackoverflow.com/users/flair/180784.png" width="208" height="58" alt="Profile for Felix at Stack Overflow, Q&amp;A for professional and enthusiast programmers" title="Profile for Felix at Stack Overflow, Q&amp;A for professional and enthusiast programmers">
  </a>
</section>


<section>
  <a class="twitter-timeline" href="https://twitter.com/foghina" data-widget-id="375313117313396736">Tweets by @foghina</a>
  <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
  
</section>


  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Felix Oghină -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'coderamblings';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://felix.oghina.com/2014/07/23/git-moving-history/';
        var disqus_url = 'http://felix.oghina.com/2014/07/23/git-moving-history/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
