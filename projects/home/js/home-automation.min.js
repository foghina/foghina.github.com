!function(a,b){function c(a,b){"use strict";this.options=b,this.rooms={};var c=$("#home-template").html(),d=Handlebars.compile(c);this.root=$(a).append(d(b));var e=$("#room-template").html();this.room_template=Handlebars.compile(e)}function d(a,b,c){"use strict";this.home=a,this.id=b,this.options=c;var d=$("#control-onoff-template").html();this.template=Handlebars.compile(d)}function e(a,b,c){"use strict";this.home=a,this.id=b,this.options=c;var d=$("#control-plusminus-template").html();this.template=Handlebars.compile(d)}function f(a,b,c){"use strict";this.home=a,this.id=b,this.options=c;var d=$("#control-slider-template").html();this.template=Handlebars.compile(d)}b.Homeatron=a,c.controls={},c.register_control=function(a,b){"use strict";c.controls[a]=b},c.prototype.add_room=function(a,b){"use strict";if(this.rooms[a]=b,b.html=$(this.room_template(b)),b.controls)for(var c=Object.keys(b.controls),d=0;d<c.length;d++)this.add_control(a,c[d],b.controls[c[d]]);this.root.append(b.html)},c.prototype.add_control=function(a,b,d){"use strict";var e=this.rooms[a];e.controls||(e.controls={}),e.controls[b]=d;var f=e.html.find(".controls");c.controls[d.type]&&(d.instance=new c.controls[d.type](this,b,d),f.append(d.instance.render()))},function(){var a=[38,38,40,40,37,39,37,39,66,65],b=[];$(document).on("keyup",function(c){b.push(c.keyCode);for(var d=0;d<Math.min(a.length,b.length);d++)if(a[d]!==b[d])return b=[],void 0;b.length===a.length&&(window.alert("AEM is pretty cool :)"),b=[])})}(),d.prototype.render=function(){"use strict";this.html=$(this.template(this.options)),this.switch=this.html.find(".make-switch").bootstrapSwitch(),this.options.on&&this.switch.bootstrapSwitch("setState",!0),this.options["on-label"]&&this.switch.bootstrapSwitch("setOnLabel",this.options["on-label"]),this.options["off-label"]&&this.switch.bootstrapSwitch("setOffLabel",this.options["off-label"]);var a=this;return this.switch.on("switch-change",function(b,c){var d=c.value;$.post(a.home.options.control_endpoint+a.id,{on:d})}),this.html},c.register_control("on-off",d),e.prototype.render=function(){"use strict";this.html=$(this.template(this.options));var a=this;return this.input=this.html.find("input").val(this.options.current).on("change",function(){var b=$(this),c=parseFloat(b.val());isNaN(c)&&(c=a.options.max_value/2+a.options.min_value/2,b.val(c)),c<a.options.min_value?(c=a.options.min_value,b.val(c)):c>a.options.max_value&&(c=a.options.max_value,b.val(c)),$.post(a.home.options.control_endpoint+a.id,{value:c})}),this.html.find("button").on("click",function(){var b=parseFloat(a.input.val());isNaN(b)&&(b=a.options.max_value/2+a.options.min_value/2);var c=$(this);c.hasClass("minus")?b-=a.options.step:c.hasClass("plus")&&(b+=a.options.step),a.input.val(b),a.input.trigger("change")}),this.html},c.register_control("plus-minus",e),f.prototype.render=function(){"use strict";this.html=$(this.template(this.options)),this.input=this.html.find("input");var a=this,b=parseFloat(this.input.val());return setInterval(function(){parseFloat(a.input.val())!==b&&(b=parseFloat(a.input.val()),$.post(a.home.options.control_endpoint+a.id,{value:b}))},500),this.html},c.register_control("slider",f),a.Home=c,a.OnOffControl=d,a.PlusMinusControl=e,a.SliderControl=f}({},function(){return this}());